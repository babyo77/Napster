const e=document.querySelectorAll(".PreviousSong"),t=document.querySelectorAll(".PlaySong"),o=document.querySelectorAll(".PauseSong"),n=document.querySelectorAll(".NextSong"),a=document.querySelectorAll(".Loading"),s=document.querySelectorAll(".Progress"),r=document.querySelectorAll(".ClosePlayer"),i=document.querySelector(".Player"),c=document.querySelector(".Content"),l=document.querySelector(".ShareNapster"),d=document.querySelector(".Search"),u=document.querySelector(".Error"),m=document.querySelector(".NotFound"),h=document.querySelector(".Refresh"),p=document.querySelector(".SearchAgain"),y=document.querySelector(".Connected"),g=document.querySelector(".SharePlayButton"),f=document.querySelector(".SharePlay"),L=document.querySelector(".Invite"),v=document.querySelector(".RoomID"),S=document.querySelector(".LikeDiv"),w=document.querySelector(".Like"),E=document.querySelector(".Full"),k=document.querySelector(".NAPSTER"),q=(document.querySelector(".loader"),document.querySelectorAll(".songLoader")),x=document.querySelector(".LoadPlaylist"),C=document.querySelector(".AllSongs"),b=new Worker("../script/worker.js"),P=new Worker("../script/views.js"),A=new URLSearchParams(window.location.search),T=document.createDocumentFragment(),H=document.querySelector(".Share"),I=document.querySelector(".Transfer"),N=document.querySelector(".News");let j,O,M,R,W,G,F=A.get("room")||"napster"+Math.random().toString(36).substr(2,6),V=document.querySelectorAll(".CurrentCover"),$=document.querySelector(".CurrentSongTitle"),z=document.querySelector(".CurrentSongTitle2"),Q=document.querySelector(".CurrentSongTitle3"),_=document.querySelectorAll(".CurrentArtist"),B=(document.querySelectorAll(".Start"),document.querySelectorAll(".End")),D="PLeVdHaf0Nk496_cnHO1uG2QdywPhpWwOS",U=[],X=parseInt(A.get("song"))||parseInt(localStorage.getItem("song"))||0;function Y(l,d){for(let e=0;e<l.length;e++){const t=l[e],o=document.createElement("div");o.classList.add("flex","cursor-pointer","song","mb-1","border","justify-between","items-center","border-none","hover:bg-zinc-900","p-3");const n=document.createElement("div");n.classList.add("flex","gap-2","items-center");const a=document.createElement("span");a.classList.add("loader","flex","overflow-hidden","h-12","w-12","rounded-md","justify-center","items-center"),a.innerHTML=`<img loading="lazy" class="h-[100%] w-[100%] object-cover" src="${t.cover}" alt=${t.title}>`;const s=document.createElement("div");s.classList.add("text-white");const r=document.createElement("h3");r.classList.add("truncate","mb-0.5","max-md:w-[73vw]","GradientText"),r.id="text"+t.id,r.textContent=t.title;const i=document.createElement("h3");i.classList.add("text-[.7rem]","text-zinc-400"),i.textContent=t.artist,s.appendChild(r),s.appendChild(i),n.appendChild(a),n.appendChild(s),o.id=t.id,o.addEventListener("click",()=>{te(!0),X=t.id,ne(X),J(t.id),se("play")}),o.appendChild(n),T.appendChild(o),C.appendChild(T)}j=document.querySelectorAll(".song"),d||(V.src=""+l[X].cover,_.textContent=l[X].artist,$.textContent=l[X].title,z.textContent=l[X].title,Q.textContent=l[X].title,a.forEach(e=>{e.remove()}),te(!1,!0),t.forEach(e=>{e.addEventListener("click",()=>{ee()})}),o.forEach(e=>{e.addEventListener("click",()=>{ee()})}),n.forEach(e=>{e.addEventListener("click",()=>{K(),se("play")})}),e.forEach(e=>{e.addEventListener("click",()=>{Z(),se("play")})}),V.forEach(e=>{e.addEventListener("touchstart",e=>{O=e.changedTouches[0].clientX},{passive:!0}),e.addEventListener("touchend",e=>{const t=e.changedTouches[0].clientX-O;t>50?Z():t<-50&&K()},{passive:!0})}),r.forEach(e=>{e.addEventListener("click",()=>{setTimeout(()=>{i.classList.remove("slide-in-top","max-md:block")},500),i.classList.add("slide-down-top")})}),c.addEventListener("click",()=>{i.classList.remove("slide-down-top"),i.classList.add("max-md:block","slide-in-top")}),s.forEach(e=>{e.addEventListener("input",e=>{G.seek(e.target.value),A.has("room")&&se("seek",e.target.value)})}))}function J(){$.classList.remove("marquee"),$.textContent=U[X].title,z.textContent=U[X].title,Q.textContent=U[X].title,V.forEach(e=>{e.src=U[X].cover||"https://your-napster.vercel.app/"+U[X].cover}),_.forEach(e=>{e.textContent=U[X].artist})}function K(){window.location.href.includes("&song")&&history.pushState({},"",window.location.href.replace("&song","")),X==U.length-1?X=0:X++,te(!0),ne()}function Z(){X>0&&(te(!0),X--,ne())}function ee(){G&&(te(!0),G.playing()?G.pause():G.play())}function te(e,n){e?(q.forEach(e=>{e.classList.remove("hidden")}),t.forEach(e=>{e.classList.add("hidden")}),o.forEach(e=>{e.classList.add("hidden")})):(q.forEach(e=>{e.classList.add("hidden")}),n&&(ne(X),t.forEach(e=>{e.classList.remove("hidden")})))}function oe(e){window.location.href.includes("?room")&&g.classList.contains("fill-green-500")?alert("Not available on Share Play ðŸ¦„ wait for update ðŸš€"):fetch("https://music-info-api.vercel.app/"+e).then(e=>{if(500==e.status)throw new Error("Error");return e.json()}).then(e=>{if(e.length>0){for(;C.firstChild;)C.removeChild(C.firstChild);U=e,X=-1,Y(U,e)}else m.classList.remove("hidden")}).catch(e=>{m.classList.remove("hidden"),console.log(e.message)})}function ne(e,n,a,r){J(),function(e){if(j)for(let e=0;e<j.length;e++){const t=j[e];t.classList.contains("bg-zinc-900")&&t.classList.remove("bg-zinc-900")}const t=document.querySelectorAll(".GradientText");for(let e=0;e<t.length;e++){t[e].classList.remove("text-[#8678f9]")}const o=document.getElementById(e);o.focus(),document.getElementById("text"+e).classList.add("text-[#8678f9]"),o.scrollIntoView({behavior:"smooth"}),C.children.item(e).classList.add("bg-zinc-900")}(X),G&&G.stop();const i=U[X].audio.replace("https://www.youtube.com/watch?v=","");G=new Howl({src:["https://unconscious-elianora-babyo7.koyeb.app/?url="+i],html5:!0,onplay:function(){localStorage.setItem("song",X),t.forEach(e=>{e.classList.add("hidden")}),o.forEach(e=>{e.classList.remove("hidden")}),te(!1),requestAnimationFrame(self.step.bind(self))},onseek:function(){requestAnimationFrame(self.step.bind(self))},onpause:function(){te(!1),t.forEach(e=>{e.classList.remove("hidden")}),o.forEach(e=>{e.classList.add("hidden")})},onend:function(){K()},onload:function(){B.forEach(e=>{e.textContent=ae(G.duration())}),te(!1),$.textContent.length>23&&window.innerWidth<=600&&$.classList.add("marquee"),s.forEach(e=>{e.max=G.duration()})},onloaderror:function(e,t){e&&console.log("server doing sex")},onplayerror:function(e,t){e&&console.log("song play error "+t)}}),navigator.mediaSession.metadata=new MediaMetadata({title:U[X].title,artist:U[X].artist,artwork:[{src:U[X].cover||"https://your-napster.vercel.app/"+U[X].cover}]}),G.play()}function ae(e){const t=Math.floor(e/60),o=Math.floor(e%60);return`${String(t).padStart(2,"0")}:${String(o).padStart(2,"0")}`}function se(e,t){"play"==e?b.postMessage(["play",F,X]):"joinRoom"==e?b.postMessage(["joinRoom",F,X]):"seek"==e?b.postMessage(["seek",F,t]):"liked"==e&&b.postMessage(["liked",F,t])}v.textContent=F,H.addEventListener("click",async()=>{navigator.share?await navigator.share({title:"Napster",text:`${U[X].title} by ${U[X].artist}`,url:window.location.origin+"?room="+F+"&playlist="+(A.get("playlist")||"PLeVdHaf0Nk496_cnHO1uG2QdywPhpWwOS")+"&share&song="+X}):alert("Unable To Share")}),d.addEventListener("click",()=>{const e=prompt("Search");e&&""!==e.trim()&&oe(e)}),I.addEventListener("click",()=>{window.open("https://www.tunemymusic.com/transfer")}),l.addEventListener("click",async()=>{navigator.share?await navigator.share({title:"Napster",text:"Listen Your Playlist Ad Free ",url:window.location.origin+"?playlist="+D}):(navigator.clipboard.writeText(window.location.origin+"?playlist="+D),alert("Copied To Clipboard"))}),x.addEventListener("click",()=>{if(window.location.href.includes("?room")&&g.classList.contains("fill-green-500"))return void alert("Not available on Share Play ðŸ¦„ wait for update ðŸš€");const e=prompt("Enter Youtube Playlist URL");if(e&&""!==e.trim()){localStorage.setItem("song",0);const t=e.replace(/^https?:\/\/youtube\.com\/playlist\?list=|&feature=shared$/g,"");oe("?url="+(t||"PLeVdHaf0Nk496_cnHO1uG2QdywPhpWwOS")),D=t,history.pushState({},"",""),history.pushState({},"","?playlist="+t)}}),h.addEventListener("click",()=>{localStorage.setItem("song",0),window.location.href=window.location.origin,u.classList.add("hidden")}),p.addEventListener("click",()=>{m.classList.add("hidden")}),y.addEventListener("click",()=>{y.classList.add("hidden")}),g.addEventListener("click",()=>{f.classList.remove("hidden")}),f.addEventListener("click",e=>{e.target.classList.contains("Invite")?e.stopPropagation():f.classList.add("hidden")}),L.addEventListener("click",async e=>{se("joinRoom");const t=window.location.origin+"?room="+F+"&playlist="+(A.get("playlist")||"PLeVdHaf0Nk496_cnHO1uG2QdywPhpWwOS")+"&share&song="+X;navigator.share?(await navigator.share({title:"Napster",text:"Napster Share Play invite link",url:t}),g.classList.add("animate-pulse"),history.pushState({},"","?room="+roomId)):(navigator.clipboard.writeText(t),alert("Copied To Clipboard")),f.classList.add("hidden"),e.stopPropagation()}),N.addEventListener("click",()=>{N.classList.add("hidden"),localStorage.setItem("news",!0)}),w.addEventListener("click",()=>{S.classList.remove("hidden"),clearTimeout(M),M=setTimeout(()=>{S.classList.add("hidden")},4e3),se("liked")}),k.addEventListener("click",()=>{oe("?url="+(A.get("playlist")||"PLeVdHaf0Nk496_cnHO1uG2QdywPhpWwOS"))}),navigator.mediaSession.setActionHandler("play",()=>{G.play()}),navigator.mediaSession.setActionHandler("pause",()=>{G.pause()}),navigator.mediaSession.setActionHandler("previoustrack",()=>{Z()}),navigator.mediaSession.setActionHandler("nexttrack",()=>{K()}),navigator.mediaSession.setActionHandler("seekto",(function(e){G.seek(e.seekTime)})),b.onmessage=e=>{const t=e.data;"connected"==t[0]||("Play"==t[0]?(X=parseInt(t[1]),ne()):"joined"==t[0]?(y.classList.remove("hidden"),w.classList.remove("hidden"),clearTimeout(R),R=setTimeout(()=>{y.classList.add("hidden")},1100),g.classList.replace("fill-red-500","fill-green-500"),g.classList.remove("animate-pules")):"seek"==t[0]?G.seek(parseInt(t[1])):"userLeft"==t[0]?(g.classList.replace("fill-green-500","fill-red-500"),g.classList.add("animate-pules"),w.classList.add("hidden")):"like"==t[0]&&(S.classList.remove("hidden"),clearTimeout(M),M=setTimeout(()=>{S.classList.add("hidden")},4e3)))},A.has("room")&&se("joinRoom"),localStorage.getItem("news")&&N.classList.add("hidden"),document.addEventListener("keydown",e=>{"Enter"===e.key&&(E.classList.replace("hidden","flex"),document.body.requestFullscreen())," "==e.key&&(ee(),console.log("ok")),"ArrowRight"===e.key&&K(),"ArrowLeft"===e.key&&Z()}),document.addEventListener("fullscreenchange",(function(){document.fullscreenElement?(E.classList.replace("hidden","flex"),E.classList.replace("opacity-0","opacity-1")):(E.classList.replace("opacity-1","opacity-0"),E.classList.replace("flex","hidden"))})),A.get("playlist")?(W="https://music-info-api.vercel.app/?url="+A.get("playlist"),D=A.get("playlist")):W="https://music-info-api.vercel.app/?url=PLeVdHaf0Nk496_cnHO1uG2QdywPhpWwOS",fetch(W).then(async e=>{if(!e.ok)throw new Error(await e.text());return e.json()}).then(e=>{U=e,P.postMessage("Count")}).then(()=>{Y(U)}).catch(e=>{u.classList.remove("hidden"),console.log(e.message)})